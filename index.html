<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartTube Finder</title>
<style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background: #f5f6fa;
  padding: 15px;
  color: #333;
}
h1 {
  text-align: center;
  font-size: 22px;
  margin-bottom: 20px;
}
.card {
  background: #fff;
  padding: 15px;
  margin-bottom: 12px;
  border-radius: 12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
img {
  width: 100%;
  border-radius: 8px;
}
.search-box {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}
input, select, button {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}
button {
  background: #007bff;
  color: white;
  font-weight: bold;
}
.results {
  display: flex;
  flex-direction: column;
}
</style>
</head>
<body>
<h1>ğŸ” SmartTube Finder</h1>

<div class="search-box">
  <input id="searchQuery" type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë³µì§€ ì‚¬ì—°)">
  <input id="minSubs" type="number" placeholder="ìµœì†Œ êµ¬ë…ì ìˆ˜">
  <input id="maxSubs" type="number" placeholder="ìµœëŒ€ êµ¬ë…ì ìˆ˜">
  <input id="minViews" type="number" placeholder="ìµœì†Œ ì¡°íšŒìˆ˜">
  <input id="maxViews" type="number" placeholder="ìµœëŒ€ ì¡°íšŒìˆ˜">
  <select id="uploadDate">
    <option value="">ì—…ë¡œë“œ ì‹œê¸° ì „ì²´</option>
    <option value="thisYear">ì˜¬í•´ ì—…ë¡œë“œ</option>
  </select>
  <button onclick="searchYouTube()">ê²€ìƒ‰í•˜ê¸°</button>
</div>

<div id="results" class="results"></div>

<script>
const API_KEY = "AIzaSyBMA6UbKczjPJkqExjd4_evvq3nUz-Agi8"; // ğŸ”’ ì—¬ê¸°ì— ë³¸ì¸ ìœ íŠœë¸Œ API í‚¤ ì…ë ¥

async function searchYouTube() {
  const query = document.getElementById("searchQuery").value;
  const minSubs = Number(document.getElementById("minSubs").value);
  const maxSubs = Number(document.getElementById("maxSubs").value);
  const minViews = Number(document.getElementById("minViews").value);
  const maxViews = Number(document.getElementById("maxViews").value);
  const uploadFilter = document.getElementById("uploadDate").value;
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "ğŸ” ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...";

  try {
    let searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(query)}&key=${API_KEY}`;
    if (uploadFilter === "thisYear") {
      const startOfYear = new Date(new Date().getFullYear(), 0, 1).toISOString();
      searchUrl += `&publishedAfter=${startOfYear}`;
    }

    const res = await fetch(searchUrl);
    const data = await res.json();

    resultsDiv.innerHTML = "";

    for (const item of data.items) {
      const videoId = item.id.videoId;
      const snippet = item.snippet;

      // ì˜ìƒ í†µê³„ ê°€ì ¸ì˜¤ê¸°
      const statsRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoId}&key=${API_KEY}`);
      const statsData = await statsRes.json();
      const stats = statsData.items[0].statistics;
      const channelId = statsData.items[0].snippet.channelId;

      // ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const channelRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${API_KEY}`);
      const channelData = await channelRes.json();
      const subs = Number(channelData.items[0].statistics.subscriberCount);
      const views = Number(stats.viewCount);

      // í•„í„° ì ìš©
      if ((minSubs && subs < minSubs) || (maxSubs && subs > maxSubs) ||
          (minViews && views < minViews) || (maxViews && views > maxViews)) continue;

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${snippet.thumbnails.medium.url}" alt="ì¸ë„¤ì¼">
        <h3>${snippet.title}</h3>
        <p>ğŸ“º ì±„ë„: ${snippet.channelTitle}</p>
        <p>ğŸ‘¥ êµ¬ë…ì: ${subs.toLocaleString()}ëª… | ğŸ‘ ì¡°íšŒìˆ˜: ${views.toLocaleString()}íšŒ</p>
        <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">ìœ íŠœë¸Œì—ì„œ ë³´ê¸° â–¶ï¸</a>
      `;
      resultsDiv.appendChild(card);
    }

    if (!resultsDiv.innerHTML) {
      resultsDiv.innerHTML = "âš ï¸ ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";
    }
  } catch (err) {
    console.error(err);
    resultsDiv.innerHTML = "âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API í‚¤ë‚˜ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
  }
}
</script>
</body>
</html>
