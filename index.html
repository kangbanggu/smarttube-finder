<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube ì±„ë„ íƒìƒ‰ê¸°</title>
  <style>
    body { font-family: "Noto Sans KR", sans-serif; background:#fafafa; color:#222; padding:20px; }
    h1 { text-align:center; }
    .filters { display:flex; flex-direction:column; gap:8px; margin-bottom:16px; }
    .filters input, select, button { padding:8px; border-radius:8px; border:1px solid #ccc; }
    .filters label { font-weight:600; margin-top:4px; }
    .results { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:12px; }
    .card { background:white; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:12px; }
    .card img { width:100%; border-radius:8px; }
    .card h3 { margin:8px 0 4px; font-size:1.1em; }
    .card p { font-size:0.9em; color:#555; }
    .meta { font-size:0.85em; color:#333; margin-top:6px; }
  </style>
</head>
<body>
  <h1>ğŸ“Š ìœ íŠœë¸Œ ë˜í¼ëŸ°ìŠ¤ ì±„ë„ íƒìƒ‰ê¸°</h1>
  
  <div class="filters">
    <label>ê²€ìƒ‰ì–´</label>
    <input type="text" id="query" placeholder="ì˜ˆ: ë³µì§€ ì‚¬ì—°, íŒ¨ì…˜, ê±´ê°• ë“±">
    
    <label>ì¡°íšŒìˆ˜ ë²”ìœ„</label>
    <div><input type="number" id="minViews" placeholder="ìµœì†Œ"> ~ <input type="number" id="maxViews" placeholder="ìµœëŒ€"></div>
    
    <label>êµ¬ë…ì ë²”ìœ„</label>
    <div><input type="number" id="minSubs" placeholder="ìµœì†Œ"> ~ <input type="number" id="maxSubs" placeholder="ìµœëŒ€"></div>
    
    <label>ì—…ë¡œë“œ ì‹œê¸°</label>
    <select id="uploadDate">
      <option value="">ì „ì²´</option>
      <option value="today">ì˜¤ëŠ˜</option>
      <option value="week">ìµœê·¼ 1ì£¼</option>
      <option value="month">ì´ë²ˆ ë‹¬</option>
      <option value="3months">3ê°œì›”</option>
      <option value="6months">6ê°œì›”</option>
      <option value="year">ì˜¬í•´</option>
    </select>
    
    <button onclick="search()">ğŸ” ê²€ìƒ‰í•˜ê¸°</button>
  </div>
  
  <div id="results" class="results"></div>
  
  <script>
    const apiKey = "AIzaSyBMA6UbKczjPJkqExjd4_evvq3nUz-Agi8"; // â† ì—¬ê¸°ì— ë³¸ì¸ ìœ íŠœë¸Œ API í‚¤ ì…ë ¥

    function getPublishedAfter(value) {
      const now = new Date();
      switch(value) {
        case "today": now.setDate(now.getDate() - 1); break;
        case "week": now.setDate(now.getDate() - 7); break;
        case "month": now.setMonth(now.getMonth() - 1); break;
        case "3months": now.setMonth(now.getMonth() - 3); break;
        case "6months": now.setMonth(now.getMonth() - 6); break;
        case "year": now.setFullYear(now.getFullYear() - 1); break;
        default: return null;
      }
      return now.toISOString();
    }

    async function search() {
      const q = document.getElementById('query').value.trim();
      const minViews = Number(document.getElementById('minViews').value) || 0;
      const maxViews = Number(document.getElementById('maxViews').value) || Infinity;
      const minSubs = Number(document.getElementById('minSubs').value) || 0;
      const maxSubs = Number(document.getElementById('maxSubs').value) || Infinity;
      const uploadDate = document.getElementById('uploadDate').value;

      if (!q) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");

      const publishedAfter = getPublishedAfter(uploadDate);
      let searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(q)}&key=${apiKey}`;
      if (publishedAfter) searchUrl += `&publishedAfter=${publishedAfter}`;
      
      const searchRes = await fetch(searchUrl);
      const searchData = await searchRes.json();

      const videoIds = searchData.items.map(i => i.id.videoId).join(',');
      const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoIds}&key=${apiKey}`;
      const detailsRes = await fetch(detailsUrl);
      const detailsData = await detailsRes.json();

      const results = document.getElementById('results');
      results.innerHTML = "";

      for (const video of detailsData.items) {
        const stats = video.statistics;
        const snippet = video.snippet;
        const views = Number(stats.viewCount || 0);
        const channelId = snippet.channelId;

        const channelRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`);
        const channelData = await channelRes.json();
        const subs = Number(channelData.items[0]?.statistics?.subscriberCount || 0);

        if (views < minViews || views > maxViews || subs < minSubs || subs > maxSubs) continue;
        const efficiency = subs > 0 ? (views / subs).toFixed(2) : "N/A";

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${snippet.thumbnails.medium.url}" alt="ì¸ë„¤ì¼">
          <h3>${snippet.title}</h3>
          <p>${snippet.description || 'ì„¤ëª… ì—†ìŒ'}</p>
          <div class="meta">
            ğŸ“º ì±„ë„: ${snippet.channelTitle}<br>
            ğŸ‘ï¸ ì¡°íšŒìˆ˜: ${views.toLocaleString()}<br>
            ğŸ‘¥ êµ¬ë…ì: ${subs.toLocaleString()}<br>
            âš¡ íš¨ìœ¨: ${efficiency}<br>
            ğŸ—“ï¸ ì—…ë¡œë“œ: ${new Date(snippet.publishedAt).toLocaleDateString()}
          </div>
          <a href="https://www.youtube.com/watch?v=${video.id}" target="_blank">â¡ï¸ ì˜ìƒ ë³´ê¸°</a>
        `;
        results.appendChild(card);
      }
    }
  </script>
</body>
</html>
